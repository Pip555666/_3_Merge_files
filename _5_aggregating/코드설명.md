# 공포-탐욕 지수 분석 코드

## 1️⃣ 개요 🧐

이 코드는 기업별 공포-탐욕 지수(Fear & Greed Index) 분석을 수행하는 Python 스크립트입니다. 특정 기업 데이터를 선택해 📊 분석하고, CSV 파일로 저장하며 그래프까지 생성합니다.

### ✅ 분석 기능:

- 시간별(hourly), 월별(monthly) 공포-탐욕 지수 계산
- 공포-탐욕 지수 변화율(change rate) 분석
- 📈 이동 평균(7일, 30일) 분석 (주석 처리됨)
- 🔍 K-Means 클러스터링 (주석 처리됨)
- 시각화 그래프 생성 및 저장

## 2️⃣ 실행 방법 🚀

원하는 기업을 선택해서 실행할 수 있습니다!

```bash
python aggregate.py --stock samsung
```

🎯 가능한 기업: `samsung`, `apple`, `nvidia`, `skhynix`

```bash
python aggregate.py --stock apple
```

만약 `--stock`을 입력하지 않으면 기본적으로 `samsung` 데이터가 분석됩니다.

## 3️⃣ 코드 상세 설명 🛠

### 📂 3.1. `setup()` - 결과 저장 폴더 생성

```python
def setup(output_dir="_5_aggregating/chart"):
```

- Matplotlib 한글 폰트 설정 🎨 (Malgun Gothic)
- 분석 결과 저장 폴더를 생성 🗂 (`_5_aggregating/chart`)
- 존재하지 않으면 자동 생성 (`os.makedirs()`)

### 📥 3.2. `load_and_preprocess()` - 데이터 불러오기 및 전처리

```python
def load_and_preprocess(file_path, data_dir="_0_data/_3_predict"):
```

- CSV 파일을 불러와 시간 데이터 변환 ⏳
- `time`을 `date`(날짜), `hour`(시간), `year`(년도), `month`(월)로 분리
- `prob_greed` 컬럼을 100배로 변환해 공포탐욕지수 계산

### 📊 3.3. `calculate_fear_greed()` - 공포탐욕지수 평균 계산

```python
def calculate_fear_greed(df, company, chart_dir):
```

- 시간별, 월별 공포탐욕지수 평균 계산
- CSV 파일로 저장 (hourly, monthly 데이터)

### 📈 3.4. `calculate_change_rate()` - 변화율 분석

```python
def calculate_change_rate(df, company, chart_dir):
```

- 전년도 대비 변화율(diff) 계산
- 연도(year), 시간(hour) 기준으로 평균 변화율 저장
- CSV 파일로 저장

### 📉 3.5. `calculate_moving_average()` - 이동 평균 분석 (주석 처리)

```python
# ✅ 이동 평균 분석 함수 (주석 처리)
def calculate_moving_average(df_monthly, company, chart_dir):
```

- 7일(단기), 30일(장기) 이동 평균 계산
- 골든크로스/데드크로스 감지 가능
- CSV 파일 저장
- ❌ 기본적으로 주석 처리됨 (필요하면 활성화 가능)

### 🎯 3.6. `cluster_analysis()` - 클러스터링 (주석 처리)

```python
# ✅ 클러스터 분석 함수 (주석 처리 유지)
def cluster_analysis(df_monthly, company, chart_dir, n_clusters=3):
```

- K-Means 클러스터링 활용
- 공포탐욕지수를 3개의 그룹으로 분류
- 📢 데이터가 3개 미만이면 클러스터링 수행 불가
- ❌ 기본적으로 주석 처리됨 (필요하면 활성화 가능)

### 🖼️ 3.7. `save_plots()` - 그래프 저장

```python
def save_plots(df_change_rate, df_monthly, company, chart_dir):
```

- 연도별 공포탐욕지수 변화율 그래프 (change rate)
- 월별 평균 공포탐욕지수 그래프 (monthly score)
- PNG 파일로 저장

### 🔄 3.8. `main()` - 메인 실행 함수

```python
def main():
    chart_dir = setup()
    file_path = f"{company}_predict_bert.csv"
    df = load_and_preprocess(file_path)
    df_monthly = calculate_fear_greed(df, company, chart_dir)
    df_change_rate = calculate_change_rate(df, company, chart_dir)
    # df_monthly = calculate_moving_average(df_monthly, company, chart_dir)
    # df_monthly = cluster_analysis(df_monthly, company, chart_dir)
    save_plots(df_change_rate, df_monthly, company, chart_dir)
```

- `setup()`으로 결과 저장 폴더 생성
- `--stock` 인자로 받은 기업 데이터 불러오기
- 공포탐욕지수 분석 & 변화율 계산
- (필요 시) 이동평균 & 클러스터링 실행 가능
- 그래프 저장

