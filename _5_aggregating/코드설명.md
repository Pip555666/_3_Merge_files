# ğŸ“Š ê¸°ì—… ê³µí¬-íƒìš• ì§€ìˆ˜ ë¶„ì„ (Fear & Greed Index)

## ğŸ“Œ ê°œìš”
ì´ í”„ë¡œì íŠ¸ëŠ” íŠ¹ì • ê¸°ì—…ì˜ **ê³µí¬-íƒìš• ì§€ìˆ˜(Fear & Greed Index)** ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³ , ì‹œê°í™”í•˜ì—¬ HDFSì— ì €ì¥í•˜ëŠ” Python ìŠ¤í¬ë¦½íŠ¸ì…ë‹ˆë‹¤. 

---

## ğŸ“‚ ì£¼ìš” ê¸°ëŠ¥

- **ê¸°ì—… ì„ íƒ**: `--stock` ì¸ìë¥¼ ì‚¬ìš©í•´ ë¶„ì„í•  ê¸°ì—… ì„ íƒ (`samsung`, `apple`, `nvidia`, `skhynix`)
- **ë°ì´í„° ë¡œë“œ ë° ì „ì²˜ë¦¬**: CSV íŒŒì¼ì—ì„œ ë‚ ì§œÂ·ì‹œê°„ ê´€ë ¨ ì»¬ëŸ¼ ì¶”ê°€ ë° ê³µí¬-íƒìš• ì§€ìˆ˜ ê³„ì‚°
- **ê³µí¬-íƒìš• ì§€ìˆ˜ ë¶„ì„**
  - ì‹œê°„ë³„/ì›”ë³„ í‰ê·  ê³µí¬-íƒìš• ì§€ìˆ˜ ê³„ì‚° ë° HDFS ì—…ë¡œë“œ
  - ê³µí¬-íƒìš• ì§€ìˆ˜ ë³€í™”ìœ¨ ê³„ì‚° ë° HDFS ì—…ë¡œë“œ
- **ë°ì´í„° ì‹œê°í™”**: ë¶„ì„ëœ ë°ì´í„°ë¥¼ ê·¸ë˜í”„ë¡œ ì €ì¥

---

## ğŸ›  ì‚¬ìš© ë°©ë²•

### 1ï¸âƒ£ ë¶„ì„í•  ê¸°ì—… ì„ íƒ ë° ì‹¤í–‰
```bash
python aggregate.py --stock samsung
```

| ì„ íƒ ê°€ëŠ¥ ê¸°ì—… |
|--------------|
| samsung     |
| apple       |
| nvidia      |
| skhynix     |

> ê¸°ë³¸ê°’: `skhynix`

### 2ï¸âƒ£ í™˜ê²½ ì„¤ì • (ê²°ê³¼ ì €ì¥ í´ë” ìƒì„±)
```python
def setup(output_dir="_5_aggregating/chart"):
    os.makedirs(output_dir, exist_ok=True)
    print(f"ğŸ“‚ Chart directory created at: {output_dir}")
    return output_dir
```
- ê²°ê³¼ë¥¼ ì €ì¥í•  í´ë”ë¥¼ ìƒì„± (`_5_aggregating/chart`)
- ì´ë¯¸ ì¡´ì¬í•˜ë©´ ë®ì–´ì“°ê¸° ë°©ì§€

### 3ï¸âƒ£ HDFS ì—…ë¡œë“œ
```python
def upload_to_hdfs(local_path, hdfs_path):
    cmd = f"hdfs dfs -put -f {local_path} {hdfs_path}"
    subprocess.run(cmd, shell=True, check=True)
```
- `hdfs dfs -put -f` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ HDFSì— íŒŒì¼ ì—…ë¡œë“œ
- ê¸°ì¡´ íŒŒì¼ì´ ìˆì„ ê²½ìš° ë®ì–´ì“°ê¸°

### 4ï¸âƒ£ ë°ì´í„° ë¡œë“œ ë° ì „ì²˜ë¦¬
```python
df = pd.read_csv(full_path, encoding="utf-8")
df["date"] = pd.to_datetime(df["time"]).dt.date
df["hour"] = pd.to_datetime(df["time"]).dt.hour
df["year"] = pd.to_datetime(df["date"]).dt.year
df["month"] = pd.to_datetime(df["date"]).dt.strftime('%Y-%m')
df["ê³µí¬íƒìš•ì§€ìˆ˜"] = df["prob_greed"] * 100
```
- `prob_greed`(íƒìš• í™•ë¥ )ë¥¼ 100ë°° í•˜ì—¬ **ê³µí¬-íƒìš• ì§€ìˆ˜(%) ë³€í™˜**
- `date`, `hour`, `year`, `month` ì»¬ëŸ¼ ì¶”ê°€

### 5ï¸âƒ£ ê³µí¬-íƒìš• ì§€ìˆ˜ ë¶„ì„
```python
df_hourly = df.groupby(["year", "hour"]).agg({"ê³µí¬íƒìš•ì§€ìˆ˜": "mean"}).reset_index()
df_monthly = df.groupby("month").agg({"ê³µí¬íƒìš•ì§€ìˆ˜": "mean"}).reset_index()
```
- **ì‹œê°„ë³„ / ì›”ë³„ í‰ê·  ê³µí¬-íƒìš• ì§€ìˆ˜ ê³„ì‚°**

#### ğŸ“¤ HDFS ì—…ë¡œë“œ
```python
hourly_path = os.path.join(chart_dir, f"{company}_hourly_feargreed_score_bert.csv")
df_hourly.to_csv(hourly_path, index=False, encoding="utf-8-sig")
upload_to_hdfs(hourly_path, os.path.join(hdfs_dir, f"{company}_hourly_feargreed_score_bert.csv"))
```

### 6ï¸âƒ£ ê³µí¬-íƒìš• ì§€ìˆ˜ ë³€í™”ìœ¨ ë¶„ì„
```python
df["feargreed_diff"] = df.groupby("year")["ê³µí¬íƒìš•ì§€ìˆ˜"].diff()
df_change_rate = df.groupby(["year", "hour"]).agg({"feargreed_diff": "mean"}).reset_index()
```
- ì‹œê°„ë³„ ë³€í™”ìœ¨ì„ ê³„ì‚°í•˜ì—¬ í‰ê· í™”

### 7ï¸âƒ£ ë°ì´í„° ì‹œê°í™”
```python
plt.plot(df_yearly["hour"], df_yearly["feargreed_diff"], marker='o', linestyle='-', color='red')
plt.savefig(change_rate_plot)
```
- ì‹œê°„ë³„ ê³µí¬-íƒìš• ë³€í™”ìœ¨ ê·¸ë˜í”„ ìƒì„± í›„ ì €ì¥

### 8ï¸âƒ£ ë©”ì¸ ì‹¤í–‰
```python
def main():
    chart_dir = setup()
    file_path = f"{company}_predict_bert.csv"
    hdfs_dir = f"/user/hdfs/{company}/"

    df = load_and_preprocess(file_path)
    df_monthly = calculate_fear_greed(df, company, chart_dir, hdfs_dir)
    df_change_rate = calculate_change_rate(df, company, chart_dir, hdfs_dir)
    save_plots(df_change_rate, df_monthly, company, chart_dir)
```

- **ì „ì²´ ì‹¤í–‰ íë¦„**:
  1. ê²°ê³¼ ì €ì¥ í´ë” ìƒì„±
  2. ë°ì´í„° ë¡œë“œ ë° ì „ì²˜ë¦¬
  3. ê³µí¬-íƒìš• ì§€ìˆ˜ ê³„ì‚°
  4. ë³€í™”ìœ¨ ê³„ì‚°
  5. ê·¸ë˜í”„ ì €ì¥ ë° HDFS ì—…ë¡œë“œ

---

## ğŸ¯ ê²°ë¡ 
âœ… `argparse`ë¥¼ ì‚¬ìš©í•´ ê¸°ì—… ì„ íƒ
âœ… ë°ì´í„°ë¥¼ ë¡œë“œí•˜ê³  ì „ì²˜ë¦¬
âœ… ì‹œê°„ë³„/ì›”ë³„ ê³µí¬-íƒìš• ì§€ìˆ˜ ê³„ì‚°
âœ… ë³€í™”ìœ¨ ë¶„ì„
âœ… HDFS ì—…ë¡œë“œ ë° ê·¸ë˜í”„ ì €ì¥

---

## ğŸ”¥ í›„ì† ì¶”ì²œ ì§ˆë¬¸

- [ ] ê³µí¬-íƒìš• ì§€ìˆ˜ ë¶„ì„ ê²°ê³¼ë¥¼ í™œìš©í•˜ì—¬ íˆ¬ì ì „ëµì„ ì„¸ìš°ëŠ” ë°©ë²• ğŸ’°
- [ ] HDFS ì—…ë¡œë“œë¥¼ ìë™í™”í•˜ëŠ” ë°©ë²• (ì—ëŸ¬ í•¸ë“¤ë§ ë° ë¡œê·¸ ê¸°ë¡ ì¶”ê°€) ğŸ”„
- [ ] ì¶”ê°€ì ì¸ ì‹œê°í™” ê¸°ë²•ì„ ì ìš©í•˜ì—¬ ë” ì¸ì‚¬ì´íŠ¸ ìˆëŠ” ë¶„ì„ì„ ìˆ˜í–‰í•˜ëŠ” ë°©ë²• ğŸ“Š
